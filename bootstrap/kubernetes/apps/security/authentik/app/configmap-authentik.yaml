---
apiVersion: v1
kind: ConfigMap
metadata:
  name: authentik-values
  namespace: security
data:
  values.yaml: |-
    # Default values for authentik.
    authentik:
      secret_key: "MXyuoc5rJ+ZY7Ets+HyBH4tv8HP86yaW/IHt5tcZzUJ4LcZbbzVVxT4aJisBI8RnoilJX2H9jJdAGwiB"

      error_reporting:
          enabled: true

      postgresql:
        host: 192.168.1.70
        # user: /postgres-creds/username
        # password: /postgres-creds/password
        database: authentik

      redis:
        host: 192.168.1.71
        architecture: standalone

      # env:
      #   - name: AUTHENTIK_POSTGRESQL__PASSWORD
      #     valueFrom:
      #       secretKeyRef:
      #         name: secret-authentik-postgres
      #         key: password

    server:
      ingress:
        # Specify kubernetes ingress controller class name
        ingressClassName: traefik
        enabled: true
        hosts:
            - authentik.synergia-it.net.ar

      env:
        - name: AUTHENTIK_POSTGRESQL__PASSWORD
          valueFrom:
            secretKeyRef:
              name: secret-authentik-postgres
              key: password
        
      # volumes:
      #   - name: postgres-creds
      #     secret:
      #       secretName: secret-authentik-postgres
      # volumeMounts:
      #   - name: postgres-creds
      #     mountPath: /postgres-creds
      #     readOnly: true

    worker:
    #   volumes:
    #     - name: postgres-creds
    #       secret:
    #         secretName: secret-authentik-postgres
    #   volumeMounts:
    #     - name: postgres-creds
    #       mountPath: /postgres-creds
    #       readOnly: true

      env:
        - name: AUTHENTIK_POSTGRESQL__PASSWORD
          valueFrom:
            secretKeyRef:
              name: secret-authentik-postgres
              key: password
