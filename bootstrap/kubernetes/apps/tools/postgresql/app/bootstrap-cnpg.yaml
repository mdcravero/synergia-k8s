---
apiVersion: v1
kind: ConfigMap
metadata:
  name: postgresql-bootstrap-sql
  namespace: tools
data:
  bootstrap.sql: |
    -- Bootstrap SQL script for PostgreSQL CNPG cluster
    -- This script runs after initdb to set up initial databases and users

    -- Create application user and database
    CREATE USER app WITH PASSWORD 'app_password' SUPERUSER;
    CREATE DATABASE app OWNER app;

    -- Grant necessary permissions
    GRANT ALL PRIVILEGES ON DATABASE app TO app;
    ALTER USER app CREATEDB;

    -- Create additional databases as needed
    CREATE DATABASE authentik;
    CREATE USER authentik WITH PASSWORD 'authentik_password';
    GRANT ALL PRIVILEGES ON DATABASE authentik TO authentik;
    ALTER USER authentik CREATEDB;

    -- Set up basic extensions
    \c app;
    CREATE EXTENSION IF NOT EXISTS pg_stat_statements;
    CREATE EXTENSION IF NOT EXISTS uuid-ossp;
>>>>>>> REPLACE