apiVersion: v1
kind: ConfigMap
metadata:
  name: parca-values
  namespace: monitoring
data:
  values.yaml: |-
    parca:
      persistentVolume:
        enabled: true
        storageClass: "nfs-client"
        accessModes:
          - ReadWriteOnce
        size: 10Gi

    ingress:
      enabled: true
      className: traefik
      hosts:
        - host: parca.synergia.net.ar
          paths:
            - path: /
              pathType: Prefix
      tls:
        - secretName: parca-tls
          hosts:
            - parca.synergia.net.ar
      annotations:
        traefik.ingress.kubernetes.io/router.entrypoints: websecure
        traefik.ingress.kubernetes.io/router.tls: "true"
        traefik.ingress.kubernetes.io/router.tls.certresolver: le
        traefik.ingress.kubernetes.io/router.middlewares: traefik-middlewares-authentik@kubernetescrd

    # Try Parca Agent with frame pointer profiling (no eBPF)
    parca-agent:
      enabled: true
      config:
        # Disable eBPF completely and use frame pointers
        bpf: false
        # Enable frame pointer based profiling
        frame-pointer: true
        # Simple configuration for home lab
        log-level: info